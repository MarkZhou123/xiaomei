version: "3"
services:
  app:
    image: 192.168.202.12:5000/{{ .Domain }}/app
    deploy:
      replicas: 2
    volumes: ["logs:/home/ubuntu/logs"]
  web:
    ports: [ "8001:80" ]
    depends_on: [ app ]
    image: 192.168.202.12:5000/{{ .Domain }}/web
    deploy:
      mode: global
      placement: { constraints: [ node.labels.hasAccess==true ] }
    volumes: ["logs:/var/log/nginx"]

volumes:
  logs:
